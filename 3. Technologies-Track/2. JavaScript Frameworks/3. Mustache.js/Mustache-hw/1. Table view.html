<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="Scripts/class.js"></script>
    <script src="Scripts/mustache.js"></script>
    <script src="Scripts/table-view.js"></script>
    <script src="Scripts/jquery-2.0.3.js"></script>
    <style>
        body, table, div, td, tr, ul, li {
            margin: 0px;
            padding: 0px;
        }

        .error-container {
            color: red;
        }

        .table-view {
            margin: 20px;
        }

            .table-view td {
                border: 1px solid black;
                padding: 10px;
                text-align: left;
                vertical-align: top;
            }

                .table-view td ul {
                    margin-left: 20px;
                }
    </style>
</head>
<body>

    <script type="X-mustache-template" id="student-template">
        <strong>{{FirstName}} {{LastName}}</strong>
        <ul>
            {{#Marks}}
            <li>
                {{Subject}}: <strong>{{Score}}</strong>
            </li>
            {{/Marks}}
            {{^Marks}}
            <li>
                No marks!
            </li>
            {{/Marks}}
        </ul>
    </script>

    <div id="content"></div>

    <script>
        $.ajax({
            url: "http://localhost:4416/api/students/",
            type: "GET",
            accept: "application/json",
            success: GenerateTableView,
            error: DisplayError,
        });

        function DisplayError(receivedData) {
            var errorContainer = $("<h1></h1>");
            errorContainer.addClass("error-container")
            errorContainer.html("Error: " +
                receivedData.status + " - " + receivedData.statusText);
            $('body').append(errorContainer);
        }

        function GenerateTableView(receivedData) {
            var template = Mustache.compile($('#student-template').html());
            var tableView = controls.getTableView(receivedData, 2);
            var tableViewHtml = tableView.render(template);
            $('#content').html(tableViewHtml);
        }
    </script>
</body>
</html>
